// No arquivo /prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // Isso lê seu .env.local
}

// ------ MODELOS ------

model FuncionarioUsuario {
  id              Int      @id @default(autoincrement())
  nome            String
  numeroRegistro  Int      @unique
  cpf             String   @unique
  email           String   @unique
  senha           String
  role            String   @default("FUNCIONARIO") // "FUNCIONARIO" ou "ADMIN"
  status          Boolean  @default(true) // Ref: Diagrama de Estado "Ativo/Inativo"
  
  // Relações
  agendamentos    Agendamento[]
  aplicacoes      AplicacoesVacina[]
}

model TipoVacina {
  id              Int      @id @default(autoincrement())
  nome            String   @unique
  descricao       String
  obrigatoriedade Boolean  @default(false)
  
  // Relações
  aplicacoes      AplicacoesVacina[]
  agendamentos    Agendamento[]
  lotes          Lote[]
}

model Lote {
  id          Int        @id @default(autoincrement())
  codigo      String     // Ex: "FA-2025"
  quantidade  Int        // Ex: 100
  validade    DateTime
  criadoEm    DateTime   @default(now())
  
  vacinaId    Int
  vacina      TipoVacina @relation(fields: [vacinaId], references: [id], onDelete: Cascade)
}

model AplicacoesVacina {
  id              Int      @id @default(autoincrement())
  dataAplicacao   DateTime
  lote            String
  
  // Relações
  funcionario     FuncionarioUsuario @relation(fields: [funcionarioId], references: [id])
  funcionarioId   Int
  
  vacina          TipoVacina @relation(fields: [vacinaId], references: [id])
  vacinaId        Int
}

model Agendamento {
  id              Int      @id @default(autoincrement())
  dataAgendamento DateTime
  status          String   // "Agendado", "Sucesso", "Falha"
  
  // Relações
  funcionario     FuncionarioUsuario @relation(fields: [funcionarioId], references: [id])
  funcionarioId   Int

  vacina          TipoVacina @relation(fields: [vacinaId], references: [id])
  vacinaId        Int
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  acao      String   // Ex: "EXCLUSAO", "CADASTRO", "LOGIN"
  recurso   String   // Ex: "Funcionário", "Vacina"
  detalhe   String   // Ex: "Removeu o funcionário João Silva"
  autor     String   // Email ou Nome de quem fez
  data      DateTime @default(now())
}